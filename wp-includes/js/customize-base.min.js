window.wp=window.wp||{},function(t,h){var s=Array.prototype.slice,e=function(t,e){e=n(this,t,e);return e.extend=this.extend,e},r=function(){},n=function(t,e,n){var i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return t.apply(this,arguments)};return h.extend(i,t),r.prototype=t.prototype,i.prototype=new r,e&&h.extend(i.prototype,e),n&&h.extend(i,n),(i.prototype.constructor=i).__super__=t.prototype,i},a={Class:function(t,e,n){var i,s=arguments;return t&&e&&a.Class.applicator===t&&(s=e,h.extend(this,n||{})),(i=this).instance&&(i=function(){return i.instance.apply(i,arguments)},h.extend(i,this)),i.initialize.apply(i,s),i}};a.Class.applicator={},a.Class.prototype.initialize=function(){},a.Class.prototype.extended=function(t){for(var e=this;void 0!==e.constructor;){if(e.constructor===t)return!0;if(void 0===e.constructor.__super__)return!1;e=e.constructor.__super__}return!1},a.Class.extend=e,a.Events={trigger:function(t){return this.topics&&this.topics[t]&&this.topics[t].fireWith(this,s.call(arguments,1)),this},bind:function(t){return this.topics=this.topics||{},this.topics[t]=this.topics[t]||h.Callbacks(),this.topics[t].add.apply(this.topics[t],s.call(arguments,1)),this},unbind:function(t){return this.topics&&this.topics[t]&&this.topics[t].remove.apply(this.topics[t],s.call(arguments,1)),this}},a.Value=a.Class.extend({initialize:function(t,e){this._value=t,this.callbacks=h.Callbacks(),h.extend(this,e||{}),this.set=h.proxy(this.set,this)},instance:function(){return arguments.length?this.set.apply(this,arguments):this.get()},get:function(){return this._value},set:function(t){var e=this._value;return t=this._setter.apply(this,arguments),null===(t=this.validate(t))||this._value===t||(this._value=t,this.callbacks.fireWith(this,[t,e])),this},_setter:function(t){return t},setter:function(t){var e=this.get();return this._setter=t,this._value=null,this.set(e),this},resetSetter:function(){return this._setter=this.constructor.prototype._setter,this.set(this.get()),this},validate:function(t){return t},bind:function(){return this.callbacks.add.apply(this.callbacks,arguments),this},unbind:function(){return this.callbacks.remove.apply(this.callbacks,arguments),this},link:function(){var t=this.set;return h.each(arguments,function(){this.bind(t)}),this},unlink:function(){var t=this.set;return h.each(arguments,function(){this.unbind(t)}),this},sync:function(){var t=this;return h.each(arguments,function(){t.link(this),this.link(t)}),this},unsync:function(){var t=this;return h.each(arguments,function(){t.unlink(this),this.unlink(t)}),this}}),a.Values=a.Class.extend({defaultConstructor:a.Value,initialize:function(t){h.extend(this,t||{}),this._value={},this._deferreds={}},instance:function(t){return 1===arguments.length?this.value(t):this.when.apply(this,arguments)},value:function(t){return this._value[t]},has:function(t){return void 0!==this._value[t]},add:function(t,e){return this.has(t)?this.value(t):((this._value[t]=e).parent=this,e.extended(a.Value)&&e.bind(this._change),this.trigger("add",e),this._deferreds[t]&&this._deferreds[t].resolve(),this._value[t])},create:function(t){return this.add(t,new this.defaultConstructor(a.Class.applicator,s.call(arguments,1)))},each:function(n,i){i=void 0===i?this:i,h.each(this._value,function(t,e){n.call(i,e,t)})},remove:function(t){var e;this.has(t)&&(e=this.value(t),this.trigger("remove",e),e.extended(a.Value)&&e.unbind(this._change),delete e.parent),delete this._value[t],delete this._deferreds[t]},when:function(){var e=this,n=s.call(arguments),i=h.Deferred();return h.isFunction(n[n.length-1])&&i.done(n.pop()),h.when.apply(h,h.map(n,function(t){if(!e.has(t))return e._deferreds[t]=e._deferreds[t]||h.Deferred()})).done(function(){var t=h.map(n,function(t){return e(t)});t.length===n.length?i.resolveWith(e,t):e.when.apply(e,n).done(function(){i.resolveWith(e,t)})}),i.promise()},_change:function(){this.parent.trigger("change",this)}}),h.extend(a.Values.prototype,a.Events),a.ensure=function(t){return"string"==typeof t?h(t):t},a.Element=a.Value.extend({initialize:function(t,e){var n,i,s=this,r=a.Element.synchronizer.html;this.element=a.ensure(t),this.events="",this.element.is("input, select, textarea")&&(this.events+="change",r=a.Element.synchronizer.val,this.element.is("input")?(t=this.element.prop("type"),a.Element.synchronizer[t]&&(r=a.Element.synchronizer[t]),"text"!==t&&"password"!==t||(this.events+=" keyup")):this.element.is("textarea")&&(this.events+=" keyup")),a.Value.prototype.initialize.call(this,null,h.extend(e||{},r)),this._value=this.get(),n=this.update,i=this.refresh,this.update=function(t){t!==i.call(s)&&n.apply(this,arguments)},this.refresh=function(){s.set(i.call(s))},this.bind(this.update),this.element.bind(this.events,this.refresh)},find:function(t){return h(t,this.element)},refresh:function(){},update:function(){}}),a.Element.synchronizer={},h.each(["html","val"],function(t,e){a.Element.synchronizer[e]={update:function(t){this.element[e](t)},refresh:function(){return this.element[e]()}}}),a.Element.synchronizer.checkbox={update:function(t){this.element.prop("checked",t)},refresh:function(){return this.element.prop("checked")}},a.Element.synchronizer.radio={update:function(t){this.element.filter(function(){return this.value===t}).prop("checked",!0)},refresh:function(){return this.element.filter(":checked").val()}},h.support.postMessage=!!window.postMessage,a.Messenger=a.Class.extend({add:function(t,e,n){return this[t]=new a.Value(e,n)},initialize:function(t,e){var n=window.parent==window?null:window.parent;h.extend(this,e||{}),this.add("channel",t.channel),this.add("url",t.url||""),this.add("targetWindow",t.targetWindow||n),this.add("origin",this.url()).link(this.url).setter(function(t){return t.replace(/([^:]+:\/\/[^\/]+).*/,"$1")}),this.receive=h.proxy(this.receive,this),this.receive.guid=h.guid++,h(window).on("message",this.receive)},destroy:function(){h(window).off("message",this.receive)},receive:function(t){var e;t=t.originalEvent,this.targetWindow()&&(this.origin()&&t.origin!==this.origin()||"string"==typeof t.data&&"{"===t.data[0]&&(e=JSON.parse(t.data))&&e.id&&void 0!==e.data&&((e.channel||this.channel())&&this.channel()!==e.channel||this.trigger(e.id,e.data)))},send:function(t,e){e=void 0===e?null:e,this.url()&&this.targetWindow()&&(e={id:t,data:e},this.channel()&&(e.channel=this.channel()),this.targetWindow().postMessage(JSON.stringify(e),this.origin()))}}),h.extend(a.Messenger.prototype,a.Events),(a=h.extend(new a.Values,a)).get=function(){var n={};return this.each(function(t,e){n[e]=t.get()}),n},t.customize=a}(wp,jQuery);